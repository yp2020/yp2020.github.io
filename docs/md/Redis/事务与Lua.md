`Redis` 提供了简单的事务功能。但是其相对于 关系型数据库中的事务模型更简单，没有那么严格。

相关的指令为 ：

1. multi 事务开始
2. exec 事务结束
3. discard 放弃事务，也就是相当于回滚

将一组需要一起执行的命令放到 `multi ` 和 `exec` 两个命令之间，让其原子顺序执行。

如果每一次事务操作涉及到的 命令比较多，可以通过 pipeline 来优化指令执行，提高执行效率。

![image-20220208212322300](https://wayne6.oss-cn-hangzhou.aliyuncs.com/img/image-20220208212322300.png)

返回 `QUEUED`代表命令没有真正的被执行，而是暂时保存在 `Redis` 中。

只有执行完 `exec ` 后，这些命令才算生效。

如果要停止事务的执行，可以使用 discard 命令来代替 exec 命令

## 错误发生时的处理机制

1. 命令错误，命令写错了（`set `写成了 `sett`），会导致整个事务无法执行。

2. 运行时错误，把 `sadd` 写成了 `zadd`  命令，语法正确，但是结果错误了，

   由于 `Redis` 的事务没有回滚功能。 所以这种情况需要开发者自己来避免。

## watch 命令

有些场景需要在事务之前，确保事务中的 `key ` 没有被其他客户端修改过才执行事务，否则不执行。这种情况可以使用 `watch` 命令。

`watch` 可以用来监控一个 `key` ，通过这种监控，我们可以确保在 exec 之前，watch 的键没有被修改过。如果修改了，那么这一次的事务提交就会失败。