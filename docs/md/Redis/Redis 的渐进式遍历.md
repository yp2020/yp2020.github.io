Redis 提供了 2 个命令遍历所有的键，keys 和 scan 

## 全量遍历键

> keys pattern

`keys`  用于遍历所有键。

但是在 Redis 的单线程架构下，如果 `Redis`  包含了大量的键，执行 `keys ` 命令可能会造成 Redis 阻塞。

## 渐进式遍历

`scan ` 采用渐近式遍历的方式来解决阻塞问题，每次的时间复杂度为 `O(1)` ，除此之外 `scan` 的参数可以控制返回结果数，可以做一个分页功能。

`scan` 每次都只是遍历一部分数据，需要多次执行才可以实现 `keys` 的 功能。

Redis 储存键值对使用的是 哈希表的数据结构，也就是说 `scan` 每次执行都只扫描一个字典中的一部分键，知道将所有的键都遍历完毕。

![image-20220321131042163](https://gitee.com/peng_beihai/pics/raw/master/img/image-20220321131042163.png)



| 参数          | 必选 还是可选 | 意义                                                         |
| ------------- | ------------- | ------------------------------------------------------------ |
| cursor        | 必选          | 游标，第一次遍历从 0 开始，每次 scan 完都会返回当前游标的值（下一次遍历使用）。直到游标值为 0，表示结束。 |
| match pattern | 可选          | 匹配的模式                                                   |
| count         | 可选          | 每次遍历的键的个数，默认为 10（可以借助这个 scan ）<br />数据集合比较大时，如果没有使用MATCH 选项, 那么命令返回的元素数量通常和 COUNT 选项指定的一样， 或者比 COUNT 选项指定的数量稍多一些。使用 MATCH, 可以通过 count 选项来指定每次迭代返回元素的最大值 |



**SCAN命令的返回值** 是一个包含两个元素的数组， 第一个数组元素是用于进行下一次迭代的新游标， 而第二个数组元素则是一个数组， 这个数组中包含了所有被迭代的元素。

### scan 遍历中键发生变化？

- 从完整遍历开始到完整遍历结束期间，一直存在于数据集内的所有元素都会被完整遍历返回。
  - 如果一个元素，它从遍历开始直到遍历结束期间都存在于被遍历的数据集当中，那么 SCAN 命令总会在某次迭代中将这个元素返回给用户。
  - 如果一个元素，它是在迭代过程中被添加到数据集的， 又或者是在迭代过程中从数据集中被删除的， 那么这个元素可能会被返回， 也可能不会。

### 其他用法

scan 是一系列的指令，除了遍历所有的 key  以外，也可以遍历某一个类型的 key

- [SCAN](http://www.redis.cn/commands/scan.html) 命令返回的每个元素都是一个 key
- [SSCAN](http://www.redis.cn/commands/sscan.html) 命令返回的每个元素都是一个集合成员。
- [HSCAN](http://www.redis.cn/commands/hscan.html) 命令返回的每个元素都是一个键值对。
- [ZSCAN](http://www.redis.cn/commands/zscan.html)命令返回的每个元素都是一个有序集合元素，一个有序集合元素由一个成员（member）和一个分值（score）组成。



