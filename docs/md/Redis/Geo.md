## 用途

支持存储地理位置信息，来实现地理信息定位功能，比如说查看附近的餐厅啥的。

## Geo Hash

`GeoHash` 是一种地址编码方法，使用这种方式，能够将二维的空间经纬度数据编码成一个 一维字符串。 

`Redis` 将所有的地理位置信息的 `geohash` 存放在 `zset` 中。

地球上经纬度的划分： 

- 以经过伦敦格林尼治天文台旧址的经线为 0 度经线，向东就是东经，向西就是西经。如果我们将西经定 义负，经度的范围就是 [-180,180]。
- 纬度北纬 90 度到南纬 90 度，如果我们将南纬定义负，则纬度的范围就是 [-90,90]。 
- 以本初子午线和赤道为界，我们可以将地球上的点分配到一个二维坐标中：

划分的次数越多，区域越多，每个区域中的面积就更小了，精确度就会提高。

### 具体样例 

以北京为例: 116.353483,39.935209

1. 纬度 39.93 ，范围为 （-90，+90），落在（0,90）中，取值为 1
2. 取中间值 45，纬度 39.93，落在（0,45）中，所以取值为 0
3. 再取中间值 22.5，纬度 39.93落在 （22.5,45）中，取值为 1.
	.... 

这样我们得到的纬度的二进制是 101

同理，经度的二进制是 110

将经纬度合并，经度占偶数位，纬度占奇数位，起始位为 1

按照 Base 32 对合并后的二进制数据进行编码，编码的时候，先将 2 进制转成 10进制，然后进行编码。

编码得到一个字符串，就是 对应的 地址对应的 hash 值。

### Geo Hash 特点

1. 一个字符串表示经纬度
2. 表示的是一个大区域，而不是一个点
3. 编码格式有规律，编码越长就越详细。精度越高，一个地址的编码后 为 123，另一个是 123456，可以看出，123456处在 123 中。
3. 两个字符串越相似，它们之间的距离越近。 Redis 用字符串前缀匹配算法实现相关命令。
3. 经纬度可以编码成 hash 值，hash值自然也可以变成经纬度(依靠专门的网站)。

## Redis 中使用 Geo

1. 增加地理位置信息   
   ![](https://wayne6.oss-cn-hangzhou.aliyuncs.com/img/image-20220130222421644.png "image-20220130222421644")

​    参数：

​    longitude 经度，

​     latitude  纬度，

​     member 成员

​    注意 这个经纬度的精确度一定要够,不然会报错

​    返回结果为添加成功的个数，已经存在的话，返回 0 

2. 获取地理位置信息

   > geopos key members members 

![](https://wayne6.oss-cn-hangzhou.aliyuncs.com/img/image-20220130223038718.png "image-20220130223038718")

3. 查看两个地址之间的距离

   ![image-20220329163127789](https://wayne6.oss-cn-hangzhou.aliyuncs.com/img/image-20220329163127789.png)

 ![](https://wayne6.oss-cn-hangzhou.aliyuncs.com/img/image-20220130223128717.png "image-20220130223128717")

4. 获取指定位置范围内的地理信息位置集合

    以一个地理位置为中心，算出指定半径内的其他地理信息位置。

   - 查看附近的成员

     ![](https://wayne6.oss-cn-hangzhou.aliyuncs.com/img/image-20220130223429058.png "image-20220130223429058")

   - 通过经纬度来查询附近的成员 就是将member 换成对应的经纬度

     ![](https://wayne6.oss-cn-hangzhou.aliyuncs.com/img/image-20220130223715031.png "image-20220130223715031")

5. 获取元素的 `geohash` 值，

![](https://gitee.com/peng_beihai/pics/raw/master/img/image-20220130223010026.png "image-20220130223010026")

 





